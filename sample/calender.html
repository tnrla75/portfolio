<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
		.calendar_container {
    position:absolute;
    left:29%;
    top:25%;
    display: flex;
    justify-content:space-evenly;
    width: 42%;
    background-color: white;
    box-shadow: 1px 1px 25px rgb(0, 0, 0 / 17%);
    border: 1px solid black;
    border-radius: 50px;
}

.hide {
    display:none;
}

.calendar_container > button {
    margin-top: 4%;
    font-weight: bold;
    height:10%;
}

.left_button {
    margin-left:17%;
    border: transparent;
}

.right_button {
    margin-right:17%;
    border: transparent;
}

.calendar {
    display:flex;
    flex-direction: column;
    justify-content:center;
    align-items: center;
    margin-top: 3%;
    margin-right:2.5%;
}


.calendar_days > button  {
    width: 48px;
    height: 47px;
    border-radius: 100%;
    background-color: transparent;
    border: transparent;
}

table {
    border-collapse: separate;
    border-spacing: 0 10px;
}

.day {
    text-align: center;
    font-size:12px;
    font-weight: bold;
    color:rgb(189, 189, 189);
}


.day_hover {
    border: 1px solid black !important;
}

.day_selected {
    background-color: black !important;
    color: #ffff;
}

.gray {
    background-color: rgb(241, 241, 241) !important;
}


	</style>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script>
	const calendarDays = document.querySelectorAll(".calendar_days"),
    calendarTitle = document.querySelector(".title"),
    leftButton = document.querySelector(".left_button"),
    rightButton = document.querySelector(".right_button"),
    calendar = document.querySelector(".calendar");
    // dateUpdate = document.querySelector(".date_update");


class Calendar {
    constructor(year, month) {
        this.today = new Date(year, month);
        this.year = this.today.getFullYear(),
            this.month = this.today.getMonth(),
            this.date = this.today.getDate(),
            this.day = this.today.getDay()
    }


    getFirstDay() {
        const firstDate = new Date(this.year, this.month);
        return firstDate.getDay();
    }

    getLastDay() {
        let wholeDays = [];
        if ((this.year % 4 === 0 && this.year % 100 !== 0) || (this.year % 400 === 0)) {
            wholeDays = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        } else {
            wholeDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        }
        return wholeDays[this.month];
    }

    fillCalendar() {
        this.initCalendar();
        calendarTitle.innerHTML = `${this.year}년 ${this.month + 1}월`
        const firstDay = this.getFirstDay();
        const lastDay = this.getLastDay();
        let day = 1;
        for (let i = firstDay; i < calendarDays.length; i++) {
            if (day <= lastDay) {
                calendarDays[i].innerHTML = `<button class = "day_button">${day}</button>`;
                day++;
            }

        }
    }

    initCalendar() {
        calendarDays.forEach((e) => {
            e.innerHTML = "";
        });
    }


    drawCalendar() {
        let change = 0;
        const today = new Date();
        let calendarInstance = new Calendar(today.getFullYear(), today.getMonth() + change);

        calendarInstance.fillCalendar();

        leftButton.addEventListener("click", (e) => {
            e.stopPropagation();
            change--;
            calendarInstance = new Calendar(today.getFullYear(), today.getMonth() + change);
            calendarInstance.fillCalendar();
            this.updateCalendarStyle();
        });
        rightButton.addEventListener("click", (e) => {
            e.stopPropagation();
            change++;
            calendarInstance = new Calendar(today.getFullYear(), today.getMonth() + change);
            calendarInstance.fillCalendar();
            this.updateCalendarStyle();
        });
    }


    updateCalendarStyle() {
        const dayButtons = document.querySelectorAll(".day_button");
        let firstSelectedDay = 0;
        let lastSelectedDay = 0;
        let clickCount = 0;

        // 달력 스타일 초기화
        dayButtons.forEach((element) => {
            element.classList.remove("day_selected");
            calendarDays.forEach((e) => e.classList.remove("gray"));
        })


        // 달력 날짜들에 클릭 이벤트 추가
        dayButtons.forEach((element) => {
            element.addEventListener("click", (event) => {
                event.target.classList.toggle("day_selected");

                clickCount++;

                // 선택 일자 타입 변환
                if (firstSelectedDay === 0) {
                    firstSelectedDay = Number(event.target.innerText);
                } else {
                    lastSelectedDay = Number(event.target.innerText);
                }

                // 클릭 횟수 2회 넘어가면 달력 스타일 초기화
                if (clickCount > 2) {
                    dayButtons.forEach((e) => {
                        e.parentNode.classList.remove("gray");
                        e.classList.remove("day_selected");
                        clickCount = 0;
                        firstSelectedDay = 0;
                        lastSelectedDay = 0;
                    });
                }

                // 선택 일자 사이에 회색 배경 적용
                if (firstSelectedDay !== 0 && lastSelectedDay !== 0) {
                    dayButtons.forEach((e) => {
                        const day = Number(e.innerText);
                        if (day >= firstSelectedDay && day <= lastSelectedDay) {
                            e.parentNode.classList.toggle("gray");
                        }
                    });
                }

                // 선택 일자 중 왼쪽값이 오른쪽 값보다 크면 회색 배경 삭제 
                if (firstSelectedDay > lastSelectedDay) {
                    dayButtons.forEach((e) => {
                        e.parentNode.classList.remove("gray");
                    });
                }
            });
        });


        // 달력 날짜들에 호버링 이벤트 추가
        dayButtons.forEach((element) => {
            element.addEventListener("mouseenter", (event) => {
                event.target.classList.add("day_hover")
            });
        });

        dayButtons.forEach((element) => {
            element.addEventListener("mouseleave", (event) => {
                event.target.classList.remove("day_hover")
            });
        });
    }



    handleEvents() {
        this.drawCalendar();
        this.updateCalendarStyle();
    }

}


const cal = new Calendar();
cal.handleEvents();

</script>
<body>

    <div class = "calendar_container"> 
        
        <button class = "left_button"> &lt </button>
        
        <table class = "calendar">
            <th class = "title">2월</th>
            <tbody>
                <tr class = "week">
                    <td class = "day">일</td>
                    <td class = "day">월</td>
                    <td class = "day">화</td>
                    <td class = "day">수</td>
                    <td class = "day">목</td>
                    <td class = "day">금</td>
                    <td class = "day">토</td>
                </tr>
                <tr>    <!-- 달력 첫 번째 줄-->
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                </tr>
                <tr>    <!-- 달력 두 번째 줄-->
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                </tr>
                <tr>    <!-- 달력 세 번째 줄-->
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                </tr>
                <tr>    <!-- 달력 네 번째 줄-->
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                </tr>
                <tr>    <!-- 달력 다섯 번째 줄-->
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                </tr>
                <tr>    <!-- 달력 여섯 번째 줄-->
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                    <td class = "calendar_days" roll = "button"> </td>
                </tr>
            </tbody>
        </table>

      

        
        <button class = "right_button"> > </button>
    </div>
    <script src = "calendar.js"></script>


</body>
</html>